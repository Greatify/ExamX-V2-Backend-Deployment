apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Common resources shared between environments
resources:
  # Core deployments
  - deployment/backend-deployment.yaml
  - deployment/celery-worker-default-deployment.yaml
  # - deployment/celery-beat-deployment.yaml
  - deployment/celery-bulk-upload-worker-deployment.yaml
  - deployment/celery-enrichment-worker-deployment.yaml
  - deployment/celery-question-generator-ai-worker-deployment.yaml
  - deployment/celery-flower-deployment.yaml
  # - deployment/redis-deployment.yaml
  
  # Services
  - services/examxv2-backend-service.yaml
  - services/celery-flower-service.yaml
  # - services/redis-service.yaml
  
  #Network
  - ingress/ingress.yaml
  
  # Configurations
  - configmap/nginx-config.yaml
  - secrets/examxv2-secrets.yaml
  - secrets/examxv2-google-credentials.yaml
  
  # Autoscaling (Traditional HPA - will be replaced by KEDA)
  - autoscaling/backend-autoscaler.yaml
  # - autoscaling/celery-worker-default-autoscaler.yaml
  # - autoscaling/celery-beat-autoscaler.yaml
  # - autoscaling/celery-bulk-upload-worker-autoscaler.yaml
  # - autoscaling/celery-enrichment-worker-autoscaler.yaml
  # - autoscaling/celery-question-generator-ai-worker-autoscaler.yaml
  - autoscaling/celery-flower-autoscaler.yaml
  # - autoscaling/redis-autoscaler.yaml
  
  # Pod Disruption Budgets
  # - pdb/backend-pdb.yaml
  # - pdb/celery-worker-default-pdb.yaml
  # - pdb/celery-bulk-upload-worker-pdb.yaml
  # - pdb/celery-enrichment-worker-pdb.yaml
  # - pdb/celery-question-generator-ai-worker-pdb.yaml
  # - pdb/celery-flower-pdb.yaml

  # Monitoring
  # - monitoring/examxv2-backend-servicemonitor.yaml

  # KEDA Queue-based Autoscaling (ScaledObjects go in app namespaces, not keda namespace)
  # Note: KEDA operator namespace is created during KEDA installation
  # No authentication required for ElastiCache Valkey
  - keda/celery-default-scaledobject.yaml
  - keda/celery-bulk-upload-scaledobject.yaml
  - keda/celery-enrichment-scaledobject.yaml
  - keda/celery-ai-generator-scaledobject.yaml
 
